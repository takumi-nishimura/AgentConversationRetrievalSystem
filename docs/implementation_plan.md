# 実装手順書: Agent Conversation Retrieval System (ACRS)

## 1. 目的
この文書は、「要件定義書: Agent Conversation Retrieval System (ACRS)」に基づき、システムの実装に必要な手順を定義します。

## 2. 実装フェーズとタスク
実装を以下のフェーズに分け、各フェーズで実施するタスクを記述します。

### フェーズ 1: プロジェクト基盤構築
*   [ ] 1.1. ディレクトリ構成の作成 (要件定義書 4.4 準拠)
*   [ ] 1.2. 依存関係管理ファイルのセットアップ (`pyproject.toml` または `requirements.txt`)
*   [ ] 1.3. 設定管理モジュール (`src/config.py`) の初期実装
*   [ ] 1.4. ロギング設定 (`logging` を利用、ファイル/標準出力) (要件定義書 3.4)
*   [ ] 1.5. Gitリポジトリの初期化と基本的な`.gitignore`の設定

### フェーズ 2: データベースとデータ管理
*   [ ] 2.1. DuckDBのセットアップと接続モジュール (`src/db/`) の実装
*   [ ] 2.2. テーブルスキーマ定義 (`conversations`, `conversation_summaries`) (要件定義書 4.3)
*   [ ] 2.3. 会話生データ格納機能 (`conversations` テーブル) の実装 (要件定義書 2.1.1)
*   [ ] 2.4. 要約・埋め込みベクトル格納機能 (`conversation_summaries` テーブル) の実装 (要件定義書 2.1.3)

### フェーズ 3: LLM連携と要約・埋め込み
*   [ ] 3.1. LiteLLM/Ollama連携モジュール (`src/llm/`) の実装
*   [ ] 3.2. 会話要約生成機能の実装 (要件定義書 2.1.2)
    *   [ ] 3.2.1. Ollama (`ArrowMint-Gemma3`) 呼び出しロジック
*   [ ] 3.3. 埋め込みモデル (`pfnet/plamo-embedding-1b`) のロードとベクトル計算機能の実装 (要件定義書 2.1.3)
    *   [ ] 3.3.1. `transformers`, `torch` を利用

### フェーズ 4: 検索コア機能
*   [ ] 4.1. 検索コアモジュール (`src/core/`) の基本構造実装
*   [ ] 4.2. ベクトル検索機能の実装 (要件定義書 2.2.3)
    *   [ ] 4.2.1. DuckDB VSS拡張機能を利用した検索
    *   [ ] 4.2.2. `conversation_summaries.embedding` へのインデックス作成
*   [ ] 4.3. 全文検索機能の実装 (要件定義書 2.2.4)
    *   [ ] 4.3.1. DuckDB FTS拡張機能 (+ 日本語トークナイザ連携 or Lindera) を利用した検索
    *   [ ] 4.3.2. `conversation_summaries.summary_text` へのインデックス作成
*   [ ] 4.4. 検索結果マージ機能の実装 (要件定義書 2.2.5)
*   [ ] 4.5. リランカーモデル (`hotchpotch/japanese-reranker-cross-encoder-large-v1`) のロードとリランキング機能の実装 (要件定義書 2.2.6)
*   [ ] 4.6. 検索インターフェース (内部関数) の実装 (要件定義書 2.2.1, 2.2.7)

### フェーズ 5: テストと評価
*   [ ] 5.1. 主要機能 (特に検索ロジック) に対する単体テストの作成 (`tests/`) (要件定義書 5.1)
*   [ ] 5.2. テストデータ (`data/`) の準備
*   [ ] 5.3. 性能測定用スクリプトの作成 (`scripts/`) (要件定義書 3.1, 5.2)
*   [ ] 5.4. 性能要件 (500ms) の確認

### フェーズ 6: ドキュメントと最終化
*   [ ] 6.1. README.md の更新 (セットアップ方法、実行方法など)
*   [ ] 6.2. 実装手順書の最終確認と更新

## 3. 成果物
*   ソースコード一式 (acrs/ ディレクトリ以下)
*   テストコード
*   README.md
*   実装手順書 (本文書)

## 4. その他
*   エラーハンドリング (要件定義書 3.2) は各機能の実装時に適宜組み込む。
*   Pythonのバージョンは 3.10 以上とする (要件定義書 4.1)。
